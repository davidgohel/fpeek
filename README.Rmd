---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
library(flextable)
```

[![Travis-CI Build Status](https://travis-ci.org/davidgohel/fpeek.svg?branch=master)](https://travis-ci.org/davidgohel/fpeek)
[![AppVeyor build status](https://ci.appveyor.com/api/projects/status/github/davidgohel/fpeek?branch=master&svg=true)](https://ci.appveyor.com/project/davidgohel/fpeek)
[![version](http://www.r-pkg.org/badges/version/fpeek)](https://CRAN.R-project.org/package=fpeek)
![cranlogs](http://cranlogs.r-pkg.org./badges/fpeek)
[![Coverage status](https://codecov.io/gh/davidgohel/fpeek/branch/master/graph/badge.svg)](https://codecov.io/github/davidgohel/fpeek?branch=master)


<p align="center">
  <img width="15%" src="http://www.ardata.fr/images/fpeek.svg">
</p>

## Motivation 

The first motivation to write that package is that many people who 
need to import text files with R don't use `head`, `tail` and 
`wc -l` commands. I noticed few use cases :

* R is installed on a Windows machine but not Rtools (i.e. in corporate environments).
* Users are unwilling to use command line, simply because there are not used to.
* R is in a `Chroot Jail` and these commands are not avalaible to the user. 

and I think these are great tools to use when importing 
text files. Having a package avalaible for that should 
make these tools easier to use for these users. 

## fpeek

The goal of fpeek is to help importation of text files from R.

When a text file has unknown characteristics, beeing able 
to have a glance at it helps to get those:

* Use function `peek_count_lines()` to count lines contained in a file.
* Functions `peek_head()` and `peek_tail()` will display 
first and last lines of the file. 

Sometimes encoding is an issue when files generated on a "Windows" machine 
has to be used on a "Linux" machine. Function `file_iconv` will converts 
file content in one encoding to another encoding.


## Installation

```{r 'github-install', eval=FALSE}
devtools::install_github("davidgohel/fpeek")
```

## Examples

First download an example file, the file is containing lot of times series 
about power system and has lot of lines.

```{r 'download-file'}
library(fpeek)
power_file <- "singleindex.csv"
if( !file.exists(power_file))
  download.file(
    "https://data.open-power-system-data.org/time_series/2018-03-13/time_series_15min_singleindex.csv", 
    destfile = power_file)
```

### Counting number of lines:

Using `wc -l`

```{r 'wcl-ex'}
system(sprintf("wc -l %s", power_file), intern = TRUE)
```

Using `peek_count_lines()`

```{r 'nlines-ex'}
peek_count_lines(power_file)
```

### Show first and last lines of a file

The first lines can be printed in the console with function `peek_head()`. 

```{r 'head-show-ex'}
peek_head(power_file, n = 4)
```

The last lines can be printed in the console with function `peek_tail()`. 

```{r 'tail-show-ex'}
peek_tail(power_file, n = 4)
```

### File reencoding

```{r 'file-iconv-ex'}
la_cigale <- system.file(package = "fpeek", "datafiles", 
  "cigale-ISO-8859-1.txt")
peek_head(path = la_cigale, n = 4, intern = TRUE)

peek_iconv(la_cigale, from = "WINDOWS-1252", to = "UTF-8")
```

Function `peek_iconv()` is converting the content of the file 
and print the result in the console. Use `peek_iconv(newfile = "...")` to create 
a new reencoded file:

```{r 'file-iconv-sink-ex'}
file_utf8 <- tempfile()
peek_iconv(path = la_cigale, newfile = file_utf8, 
  from = "WINDOWS-1252", to = "UTF-8")
```

## Comparing speed with original tools:

> function `peek_count_lines`

```{r 'bench-nlines', message=FALSE, warning=FALSE}
library(microbenchmark)

benchmark <- microbenchmark(times = 20, 
  "peek_count_lines" = { peek_count_lines(power_file) },
  "wc -l command" = { system(sprintf("wc -l %s", power_file), intern = TRUE) }
  )

benchmark
```

> function `peek_head`


```{r 'bench-head-show', message=FALSE, warning=FALSE, results='hide'}
library(microbenchmark)
benchmark <- microbenchmark(times = 20, 
  "peek_head" = { peek_head(power_file, n = 5) },
  "head command" = { system(sprintf("head -n 5 %s", power_file), intern = FALSE) }
  )
```

```{r}
benchmark
```

> function `peek_tail`


```{r 'bench-tail-show', message=FALSE, warning=FALSE, results='hide'}
library(microbenchmark)
benchmark <- microbenchmark(times = 20, 
  "peek_tail" = { peek_tail(power_file, n = 5) },
  "tail command" = { system(sprintf("tail -n 5 %s", power_file), intern = FALSE) }
  )
```

```{r}
benchmark
```

